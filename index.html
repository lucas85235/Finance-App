<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard de organizaÃ§Ã£o financeira pessoal">
    <title>ğŸ’° Finance Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/financing.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- jsPDF & AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <span class="logo">ğŸ’°</span>
                <h1>Finance Dashboard</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="ui.showCategoriesModal()" title="Gerenciar Categorias">
                    <span class="btn-icon">ğŸ·ï¸</span>
                    Categorias
                </button>
                <label class="btn btn-secondary" for="import-file">
                    <span class="btn-icon">ğŸ“¥</span>
                    Importar CSV
                </label>
                <input type="file" id="import-file" accept=".csv" hidden>
                <button class="btn btn-secondary" id="export-btn">
                    <span class="btn-icon">ğŸ“¤</span>
                    Exportar CSV
                </button>
                <!-- JSON Backup Controls -->
                <button class="btn btn-secondary" id="backup-btn" title="Backup completo (JSON)">
                    <span class="btn-icon">ğŸ’¾</span>
                    Backup
                </button>
                <label class="btn btn-secondary" for="restore-file" title="Restaurar backup (JSON)">
                    <span class="btn-icon">â™»ï¸</span>
                    Restaurar
                </label>
                <input type="file" id="restore-file" accept=".json" hidden>
            </div>
        </header>

        <!-- Summary Cards -->
        <section class="summary-section">
            <div class="summary-card income">
                <div class="card-icon">ğŸ“ˆ</div>
                <div class="card-content">
                    <span class="card-label">Receitas</span>
                    <span class="card-value" id="total-income">R$ 0,00</span>
                </div>
            </div>
            <div class="summary-card expense">
                <div class="card-icon">ğŸ“‰</div>
                <div class="card-content">
                    <span class="card-label">Despesas</span>
                    <span class="card-value" id="total-expense">R$ 0,00</span>
                </div>
            </div>
            <div class="summary-card balance">
                <div class="card-icon">ğŸ’</div>
                <div class="card-content">
                    <span class="card-label">Saldo</span>
                    <span class="card-value" id="total-balance">R$ 0,00</span>
                </div>
            </div>
        </section>

        <!-- Transaction Form -->
        <section class="form-section">
            <h2 class="section-title">â• Nova TransaÃ§Ã£o</h2>
            <form id="transaction-form" class="transaction-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="type">Tipo</label>
                        <select id="type" name="type" required>
                            <option value="income">ğŸ’µ Receita</option>
                            <option value="expense">ğŸ’¸ Despesa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Valor (R$)</label>
                        <input type="number" id="amount" name="amount" step="0.01" min="0.01" placeholder="0,00"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="category">Categoria</label>
                        <select id="category" name="category" required>
                            <option value="SalÃ¡rio">ğŸ’¼ SalÃ¡rio</option>
                            <option value="Freelance">ğŸ’» Freelance</option>
                            <option value="Investimentos">ğŸ“Š Investimentos</option>
                            <option value="Outros Receita">ğŸ’° Outros</option>
                            <option value="AlimentaÃ§Ã£o">ğŸ” AlimentaÃ§Ã£o</option>
                            <option value="Transporte">ğŸš— Transporte</option>
                            <option value="Moradia">ğŸ  Moradia</option>
                            <option value="SaÃºde">ğŸ¥ SaÃºde</option>
                            <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                            <option value="Lazer">ğŸ® Lazer</option>
                            <option value="Compras">ğŸ›’ Compras</option>
                            <option value="Contas">ğŸ“„ Contas</option>
                            <option value="Outros Despesa">ğŸ“¦ Outros</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group flex-2">
                        <label for="description">DescriÃ§Ã£o</label>
                        <input type="text" id="description" name="description" placeholder="Ex: SalÃ¡rio do mÃªs"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="account">Conta</label>
                        <input type="text" id="account" name="account" placeholder="Ex: C6, Nubank">
                    </div>
                    <div class="form-group">
                        <label for="date">Data</label>
                        <input type="date" id="date" name="date" required>
                    </div>
                    <div class="form-group form-submit">
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-icon">âœ“</span>
                            Adicionar
                        </button>
                    </div>
                </div>
            </form>
        </section>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Transactions Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“‹ TransaÃ§Ãµes</h2>
                    <div class="filter-group">
                        <input type="text" id="search-input" class="search-input" placeholder="ğŸ” Buscar..."
                            title="Buscar por descriÃ§Ã£o">
                        <select id="filter-period" class="filter-select" title="Filtrar por perÃ­odo">
                            <option value="all">Todos os perÃ­odos</option>
                        </select>
                        <select id="filter-type" class="filter-select" title="Filtrar por tipo">
                            <option value="all">Todos</option>
                            <option value="income">Receitas</option>
                            <option value="expense">Despesas</option>
                        </select>
                        <button class="btn btn-secondary" id="report-btn" title="Baixar RelatÃ³rio PDF">
                            <span class="btn-icon">ğŸ“„</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>DescriÃ§Ã£o</th>
                                <th>Categoria</th>
                                <th>Conta</th>
                                <th>Valor</th>
                                <th>AÃ§Ã£o</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-body">
                            <!-- Transactions will be inserted here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="empty-state">
                        <span class="empty-icon">ğŸ“­</span>
                        <p>Nenhuma transaÃ§Ã£o cadastrada</p>
                        <span class="empty-hint">Adicione sua primeira transaÃ§Ã£o acima</span>
                    </div>
                </div>
            </section>

            <!-- Charts Grid -->
            <div class="charts-grid">
                <!-- Category Chart -->
                <section class="chart-section">
                    <h2 class="section-title">ğŸ“Š Gastos por Categoria</h2>
                    <div class="chart-container">
                        <canvas id="category-chart"></canvas>
                        <div class="chart-empty" id="chart-empty">
                            <span class="empty-icon">ğŸ“ˆ</span>
                            <p>Adicione despesas para ver o grÃ¡fico</p>
                        </div>
                    </div>
                </section>

                <!-- Monthly Evolution Chart -->
                <section class="chart-section">
                    <h2 class="section-title">ğŸ“ˆ EvoluÃ§Ã£o Mensal</h2>
                    <div class="chart-container chart-container-wide">
                        <canvas id="monthly-chart"></canvas>
                        <div class="chart-empty" id="monthly-chart-empty">
                            <span class="empty-icon">ğŸ“‰</span>
                            <p>Adicione transaÃ§Ãµes para ver a evoluÃ§Ã£o</p>
                        </div>
                    </div>
                </section>
            </div>
            <!-- Top 5 Expenses -->
            <section class="chart-section" style="margin-top: var(--spacing-xl);">
                <h2 class="section-title">ğŸ† Top 5 Despesas</h2>
                <div class="top-expenses-container" id="top-expenses-list">
                    <!-- Top expenses will be inserted here -->
                    <div class="empty-state">
                        <p>Adicione despesas para ver o ranking</p>
                    </div>
                </div>
            </section>

            <!-- Financing Section -->
            <section class="financing-section" id="financing-section">
                <div class="financing-header-section">
                    <h2 class="section-title">ğŸ’¸ Meus Financiamentos</h2>
                    <button class="btn btn-primary" id="add-financing-btn">
                        <span class="btn-icon">ğŸ†•</span> Novo Financiamento
                    </button>
                </div>

                <!-- Financing Summary -->
                <div id="financing-summary">
                    <!-- Summary cards here -->
                </div>

                <!-- Active Financings -->
                <div class="financings-grid" id="financings-list">
                    <!-- Cards inserted via JS -->
                </div>
            </section>
        </div>

        <!-- Edit Modal -->
        <div class="modal-overlay" id="edit-modal" hidden>
            <div class="modal">
                <div class="modal-header">
                    <h3>âœï¸ Editar TransaÃ§Ã£o</h3>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>
                <form id="edit-form" class="transaction-form">
                    <input type="hidden" id="edit-id" name="id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-type">Tipo</label>
                            <select id="edit-type" name="type" required>
                                <option value="income">ğŸ’µ Receita</option>
                                <option value="expense">ğŸ’¸ Despesa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-amount">Valor (R$)</label>
                            <input type="number" id="edit-amount" name="amount" step="0.01" min="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-category">Categoria</label>
                            <select id="edit-category" name="category" required>
                                <option value="SalÃ¡rio">ğŸ’¼ SalÃ¡rio</option>
                                <option value="Freelance">ğŸ’» Freelance</option>
                                <option value="Investimentos">ğŸ“Š Investimentos</option>
                                <option value="Outros Receita">ğŸ’° Outros</option>
                                <option value="AlimentaÃ§Ã£o">ğŸ” AlimentaÃ§Ã£o</option>
                                <option value="Transporte">ğŸš— Transporte</option>
                                <option value="Moradia">ğŸ  Moradia</option>
                                <option value="SaÃºde">ğŸ¥ SaÃºde</option>
                                <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                                <option value="Lazer">ğŸ® Lazer</option>
                                <option value="Compras">ğŸ›’ Compras</option>
                                <option value="Contas">ğŸ“„ Contas</option>
                                <option value="Outros Despesa">ğŸ“¦ Outros</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label for="edit-description">DescriÃ§Ã£o</label>
                            <input type="text" id="edit-description" name="description" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-account">Conta</label>
                            <input type="text" id="edit-account" name="account">
                        </div>
                        <div class="form-group">
                            <label for="edit-date">Data</label>
                            <input type="date" id="edit-date" name="date" required>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="modal-cancel">Cancelar</button>
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-icon">âœ“</span>
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Financing Modal -->
        <div class="modal-overlay" id="add-financing-modal" hidden>
            <div class="modal">
                <div class="modal-header">
                    <h3>ğŸ¦ Novo Financiamento</h3>
                    <button class="modal-close" id="add-financing-close">&times;</button>
                </div>
                <form id="add-financing-form" class="transaction-form">
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label for="fin-name">Nome / DescriÃ§Ã£o</label>
                            <input type="text" id="fin-name" name="name" placeholder="Ex: Casa PrÃ³pria, Carro..."
                                required>
                        </div>
                        <div class="form-group">
                            <label for="fin-type">Tipo</label>
                            <select id="fin-type" name="type" required>
                                <option value="house">ğŸ  ImÃ³vel</option>
                                <option value="vehicle">ğŸš— VeÃ­culo</option>
                                <option value="other">ğŸ“‹ Outro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fin-principal">Valor Financiado (R$)</label>
                            <input type="number" id="fin-principal" name="principal" step="0.01" min="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="fin-rate">Taxa Anual (%)</label>
                            <input type="number" id="fin-rate" name="annualRate" step="0.01" min="0.01"
                                placeholder="Ex: 9.5" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fin-term">Prazo (meses)</label>
                            <input type="number" id="fin-term" name="termMonths" min="1" placeholder="Ex: 360" required>
                        </div>
                        <div class="form-group">
                            <label for="fin-system">Sistema</label>
                            <select id="fin-system" name="system" required>
                                <option value="PRICE">PRICE (Parcelas fixas)</option>
                                <option value="SAC">SAC (AmortizaÃ§Ã£o constante)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fin-start">Data InÃ­cio</label>
                            <input type="date" id="fin-start" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="fin-cet">CET (%) <small>(Opcional)</small></label>
                            <input type="number" id="fin-cet" name="cetRate" step="0.01">
                        </div>
                        <div class="form-group form-submit">
                            <button type="submit" class="btn btn-primary">Cadastrar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Amortization Table Modal -->
        <div class="modal-overlay" id="amortization-modal" hidden>
            <div class="modal" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 id="amortization-title">ğŸ“Š Tabela de AmortizaÃ§Ã£o</h3>
                    <button class="modal-close" id="amortization-close">&times;</button>
                </div>
                <div class="amortization-table-container">
                    <table class="amortization-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Vencimento</th>
                                <th>AmortizaÃ§Ã£o</th>
                                <th>Juros</th>
                                <th>Parcela</th>
                                <th>Saldo Devedor</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="amortization-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Extra Amortization Modal -->
        <div class="modal-overlay" id="extra-amortization-modal" hidden>
            <div class="modal">
                <div class="modal-header">
                    <h3>ğŸ’° AmortizaÃ§Ã£o Extra</h3>
                    <button class="modal-close" id="extra-amortization-close">&times;</button>
                </div>
                <form id="extra-amortization-form">
                    <div class="form-group">
                        <label>Financiamento: <strong id="extra-financing-name">...</strong></label>
                    </div>
                    <div class="form-group">
                        <label for="extra-amount">Valor da AmortizaÃ§Ã£o (R$)</label>
                        <input type="number" id="extra-amount" step="0.01" min="0.01" placeholder="0,00" required>
                    </div>
                    <div class="form-group">
                        <label>EstratÃ©gia</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="extra-strategy" value="reduce_term" checked>
                                â³ Reduzir Prazo (Manter valor da parcela)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="extra-strategy" value="reduce_payment">
                                ğŸ“‰ Reduzir Parcela (Manter prazo original)
                            </label>
                        </div>
                    </div>

                    <!-- Simulation Result -->
                    <div id="simulation-result" class="simulation-result" hidden></div>

                    <div class="form-submit" style="margin-top: 1rem;">
                        <button type="submit" class="btn btn-primary">Confirmar AmortizaÃ§Ã£o</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal ComparaÃ§Ã£o de CenÃ¡rios -->
    <div id="scenario-modal" class="modal-overlay hidden">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3>Simular CenÃ¡rios</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="filter-bar">
                    <div class="form-group" style="flex: 1;">
                        <label for="scenario-amount">Valor Extra (R$)</label>
                        <input type="number" id="scenario-amount" step="0.01" min="0.01" placeholder="Ex: 5000,00">
                    </div>
                    <button id="btn-simulate-scenarios" class="btn btn-primary"
                        style="align-self: flex-end; margin-bottom: 1rem;">
                        Simular
                    </button>
                </div>

                <div id="scenario-results" class="scenario-grid hidden">
                    <!-- Cards for comparison will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Categories Modal -->
    <div class="modal-overlay" id="categories-modal" hidden>
        <div class="modal">
            <div class="modal-header">
                <h3>ğŸ·ï¸ Gerenciar Categorias</h3>
                <button class="modal-close" id="categories-close">&times;</button>
            </div>

            <div class="categories-container">
                <!-- Add New Category Form -->
                <form id="add-category-form" class="add-category-form">
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label for="new-cat-name">Nome</label>
                            <input type="text" id="new-cat-name" placeholder="Ex: Viagem" required>
                        </div>
                        <div class="form-group">
                            <label for="new-cat-icon">Ãcone</label>
                            <select id="new-cat-icon">
                                <option value="ğŸ“¦">ğŸ“¦</option>
                                <option value="âœˆï¸">âœˆï¸</option>
                                <option value="ğŸ’Š">ğŸ’Š</option>
                                <option value="ğŸ“">ğŸ“</option>
                                <option value="ğŸ‰">ğŸ‰</option>
                                <option value="ğŸ”§">ğŸ”§</option>
                                <option value="ğŸ‘¶">ğŸ‘¶</option>
                                <option value="ğŸ•">ğŸ•</option>
                                <option value="ğŸ¦">ğŸ¦</option>
                                <option value="ğŸ’³">ğŸ’³</option>
                                <option value="ğŸ½ï¸">ğŸ½ï¸</option>
                                <option value="ğŸšŒ">ğŸšŒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-cat-type">Tipo</label>
                            <select id="new-cat-type">
                                <option value="expense">ğŸ’¸ Despesa</option>
                                <option value="income">ğŸ’µ Receita</option>
                            </select>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button type="submit" class="btn btn-primary" style="margin-top: 0;">
                                +
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Categories List -->
                <div class="categories-list-header">
                    <span>Minhas Categorias</span>
                    <small>Clique no ğŸ—‘ï¸ para remover</small>
                </div>
                <div class="categories-list" id="categories-list">
                    <!-- Categories will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- App Entry Point (ES6 Module) -->
    <script type="module" src="js/app.js"></script>
</body>

</html>