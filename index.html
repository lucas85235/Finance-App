<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard de organiza√ß√£o financeira pessoal">
    <title>üí∞ Finance Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/financing.css">
    <link rel="stylesheet" href="css/shell.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- jsPDF & AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <div id="app-shell">
        <!-- 1. Sidebar -->
        <aside id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-logo">üí∞</span>
                <span class="sidebar-title">Finance</span>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-view="transactions">
                    <span class="nav-icon">üìã</span>
                    Transa√ß√µes
                </a>
                <a href="#" class="nav-item" data-view="categories">
                    <span class="nav-icon">üè∑Ô∏è</span>
                    Categorias
                </a>
                <a href="#" class="nav-item" data-view="financing">
                    <span class="nav-icon">üí∏</span>
                    Financiamentos
                </a>
                <a href="#" class="nav-item" data-view="reports">
                    <span class="nav-icon">üìë</span>
                    Relat√≥rios
                </a>
                <a href="#" class="nav-item" data-view="data">
                    <span class="nav-icon">üíæ</span>
                    Dados
                </a>
            </nav>
        </aside>

        <!-- 2. Topbar -->
        <header id="topbar">
            <div class="topbar-left">
                <button id="sidebar-toggle" class="btn-icon-only mobile-only" title="Menu">
                    ‚ò∞
                </button>
                <h2 id="page-title" class="page-title">Dashboard</h2>
            </div>
            <div class="topbar-center">
                <div class="global-search">
                    <input type="text" placeholder="Buscar (Cmd+K)..." id="global-search-input">
                </div>
            </div>
            <div class="topbar-right">
                <!-- Period Selector moved here -->
                <select id="filter-period-global" class="filter-select" title="Filtrar por per√≠odo">
                    <option value="month">Este M√™s</option>
                    <option value="90days">√öltimos 90 dias</option>
                    <option value="custom">Personalizado</option>
                </select>

                <button class="btn btn-secondary btn-sm" id="toggle-privacy" title="Ocultar valores">
                    üëÅÔ∏è
                </button>
                <button class="btn btn-primary" id="btn-new-transaction">
                    + Nova
                </button>
            </div>
        </header>

        <!-- 3. Main Content -->
        <main id="main-content">

            <!-- View: Dashboard -->
            <div id="view-dashboard" class="view active">
                <section class="summary-section" id="dashboard-summary">
                    <div class="summary-card income">
                        <div class="card-icon">üìà</div>
                        <div class="card-content">
                            <span class="card-label">Receitas</span>
                            <span class="card-value" id="total-income">R$ 0,00</span>
                        </div>
                    </div>
                    <div class="summary-card expense">
                        <div class="card-icon">üìâ</div>
                        <div class="card-content">
                            <span class="card-label">Despesas</span>
                            <span class="card-value" id="total-expense">R$ 0,00</span>
                        </div>
                    </div>
                    <div class="summary-card balance">
                        <div class="card-icon">üíé</div>
                        <div class="card-content">
                            <span class="card-label">Saldo</span>
                            <span class="card-value" id="total-balance">R$ 0,00</span>
                        </div>
                    </div>
                </section>

                <div class="charts-grid">
                    <section class="chart-section">
                        <h2 class="section-title">üìä Gastos por Categoria</h2>
                        <div class="chart-container">
                            <canvas id="category-chart"></canvas>
                        </div>
                    </section>
                    <section class="chart-section">
                        <h2 class="section-title">üìà Evolu√ß√£o Mensal</h2>
                        <div class="chart-container">
                            <canvas id="monthly-chart"></canvas>
                        </div>
                    </section>
                </div>

                <section class="chart-section" style="margin-top: 2rem;">
                    <h2 class="section-title">üèÜ Top 5 Despesas</h2>
                    <div id="top-expenses-list"></div>
                </section>
            </div>

            <!-- View: Transactions -->
            <div id="view-transactions" class="view">
                <div class="section-header">
                    <div class="filter-group">
                        <select id="filter-type" class="filter-select">
                            <option value="all">Todos os Tipos</option>
                            <option value="income">Receitas</option>
                            <option value="expense">Despesas</option>
                        </select>
                        <select id="filter-category" class="filter-select">
                            <option value="all">Todas as Categorias</option>
                            <!-- Populated via JS -->
                        </select>
                        <input type="text" id="search-input" class="search-input" placeholder="Filtrar na tabela...">
                    </div>
                </div>
                <div class="table-container" style="height: calc(100vh - 200px);">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descri√ß√£o</th>
                                <th>Categoria</th>
                                <th>Conta</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-body">
                            <!-- Transactions injected here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="empty-state">
                        <span class="empty-icon">üì≠</span>
                        <p>Nenhuma transa√ß√£o cadastrada</p>
                    </div>
                </div>
            </div>

            <!-- View: Financing -->
            <div id="view-financing" class="view">
                <div class="financing-header-section"
                    style="display: flex; justify-content: space-between; margin-bottom: 2rem;">
                    <h2 class="section-title">Meus Financiamentos</h2>
                    <button class="btn btn-primary" id="add-financing-btn">
                        <span class="btn-icon">üÜï</span> Novo
                    </button>
                </div>
                <div id="financing-summary" style="margin-bottom: 2rem;"></div>
                <div class="financings-grid" id="financings-list"
                    style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                </div>
            </div>

            <!-- View: Categories -->
            <div id="view-categories" class="view">
                <div id="categories-view-content" style="padding: 2rem;">
                    <h2>Gerenciar Categorias</h2>
                    <p>Selecione uma categoria para editar ou crie uma nova.</p>
                    <div id="categories-list-view" class="categories-list"></div>
                </div>
            </div>

            <!-- View: Data (Import/Export) -->
            <div id="view-data" class="view">
                <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                    <section class="chart-section" style="flex: 1; min-width: 300px;">
                        <h3>üì• Importar</h3>
                        <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                            <label class="btn btn-secondary" for="import-file">
                                üìë Importar CSV
                            </label>
                            <label class="btn btn-secondary" for="restore-file">
                                üíæ Restaurar Backup (JSON)
                            </label>
                            <!-- Hidden inputs -->
                            <input type="file" id="import-file" accept=".csv" hidden>
                            <input type="file" id="restore-file" accept=".json" hidden>
                        </div>
                    </section>
                    <section class="chart-section" style="flex: 1; min-width: 300px;">
                        <h3>üì§ Exportar</h3>
                        <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                            <button class="btn btn-secondary" id="export-btn">
                                üìë Exportar CSV
                            </button>
                            <button class="btn btn-secondary" id="backup-btn">
                                üíæ Backup Completo (JSON)
                            </button>
                            <button class="btn btn-secondary" id="report-btn">
                                üìÑ Relat√≥rio PDF
                            </button>
                        </div>
                    </section>
                </div>
            </div>

        </main>

        <!-- 4. Inspector Panel -->
        <aside id="inspector" class="inspector">
            <div class="inspector-header">
                <h3>Detalhes</h3>
                <button class="inspector-close" onclick="ui.closeInspector()">&times;</button>
            </div>
            <div id="inspector-content" class="inspector-content">
                <p class="text-muted" style="text-align: center; margin-top: 2rem;">
                    Selecione um item para ver detalhes
                </p>
            </div>
        </aside>
    </div>

    <!-- Legacy Modals (To be refactored into Inspector later, keeping for compatibility during transition) -->
    <!-- We will keep the Forms hidden but accessible if we need to grab their HTML for Inspector instanciation -->

    <!-- Edit Modal Structure REPURPOSED for Inspector Templates? -->
    <!-- Actually, let's keep the modal structure for now at the bottom of body to avoid breaking JS selectors immediately -->
    <!-- We will hide them and use them as templates or eventually delete them. -->


    <!-- Financing Modals (Restored) -->
    <div id="add-financing-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>Novo Financiamento</h3>
                <button class="close-modal" id="add-financing-close">&times;</button>
            </div>
            <form id="add-financing-form">
                <div class="form-group">
                    <label for="name">Nome/Descri√ß√£o</label>
                    <input type="text" name="name" required placeholder="Ex: Financiamento Casa">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="type">Tipo</label>
                        <select name="type">
                            <option value="house">üè† Im√≥vel</option>
                            <option value="vehicle">üöó Ve√≠culo</option>
                            <option value="other">üìã Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="system">Sistema</label>
                        <select name="system">
                            <option value="sac">SAC (Parcelas decrescentes)</option>
                            <option value="price">Price (Parcelas fixas)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="principal">Valor Financiado</label>
                        <input type="number" name="principal" required step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="annualRate">Taxa Anual (%)</label>
                        <input type="number" name="annualRate" required step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="termMonths">Prazo (meses)</label>
                        <input type="number" name="termMonths" required step="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="startDate">Data In√≠cio</label>
                        <input type="date" name="startDate" id="financing-start-date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cetRate">CET Anual (%) <small>(Opcional)</small></label>
                    <input type="number" name="cetRate" step="0.01" min="0">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Salvar Financiamento</button>
            </form>
        </div>
    </div>

    <div id="amortization-modal" class="modal-overlay hidden">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3 id="amortization-title">Tabela de Amortiza√ß√£o</h3>
                <button class="close-modal" id="amortization-close">&times;</button>
            </div>
            <div class="table-container" style="max-height: 60vh;">
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Vencimento</th>
                            <th>Amortiza√ß√£o</th>
                            <th>Juros</th>
                            <th>Presta√ß√£o</th>
                            <th>Saldo Devedor</th>
                            <th>Status.</th>
                        </tr>
                    </thead>
                    <tbody id="amortization-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="extra-amortization-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>Amortiza√ß√£o Extra</h3>
                <button class="close-modal" id="extra-amortization-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Financiamento: <strong id="extra-financing-name"></strong></p>
                <form id="extra-amortization-form">
                    <div class="form-group">
                        <label for="extra-amount">Valor a Amortizar (R$)</label>
                        <input type="number" id="extra-amount" name="amount" required step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>Estrat√©gia</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="extra-strategy" value="reduce_term" checked>
                                Reduzir Prazo (Manter valor da parcela)
                            </label>
                            <label>
                                <input type="radio" name="extra-strategy" value="reduce_payment">
                                Reduzir Parcela (Manter prazo original)
                            </label>
                        </div>
                    </div>

                    <div id="simulation-result" class="simulation-result hidden"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-block">Confirmar Amortiza√ß√£o</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Compara√ß√£o de Cen√°rios -->
    <div id="scenario-modal" class="modal-overlay hidden">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3>Simular Cen√°rios</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="filter-bar">
                    <div class="form-group" style="flex: 1;">
                        <label for="scenario-amount">Valor Extra (R$)</label>
                        <input type="number" id="scenario-amount" step="0.01" min="0.01" placeholder="Ex: 5000,00">
                    </div>
                    <button id="btn-simulate-scenarios" class="btn btn-primary"
                        style="align-self: flex-end; margin-bottom: 1rem;">
                        Simular
                    </button>
                </div>

                <div id="scenario-results" class="scenario-grid hidden">
                    <!-- Cards for comparison will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Categories Modal -->
    <div class="modal-overlay" id="categories-modal" hidden>
        <div class="modal">
            <div class="modal-header">
                <h3>üè∑Ô∏è Gerenciar Categorias</h3>
                <button class="modal-close" id="categories-close">&times;</button>
            </div>

            <div class="categories-container">
                <!-- Add New Category Form -->
                <form id="add-category-form" class="add-category-form">
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label for="new-cat-name">Nome</label>
                            <input type="text" id="new-cat-name" placeholder="Ex: Viagem" required>
                        </div>
                        <div class="form-group">
                            <label for="new-cat-icon">√çcone</label>
                            <select id="new-cat-icon">
                                <option value="üì¶">üì¶</option>
                                <option value="‚úàÔ∏è">‚úàÔ∏è</option>
                                <option value="üíä">üíä</option>
                                <option value="üéì">üéì</option>
                                <option value="üéâ">üéâ</option>
                                <option value="üîß">üîß</option>
                                <option value="üë∂">üë∂</option>
                                <option value="üêï">üêï</option>
                                <option value="üè¶">üè¶</option>
                                <option value="üí≥">üí≥</option>
                                <option value="üçΩÔ∏è">üçΩÔ∏è</option>
                                <option value="üöå">üöå</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-cat-type">Tipo</label>
                            <select id="new-cat-type">
                                <option value="expense">üí∏ Despesa</option>
                                <option value="income">üíµ Receita</option>
                            </select>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button type="submit" class="btn btn-primary" style="margin-top: 0;">
                                +
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Categories List -->
                <div class="categories-list-header">
                    <span>Minhas Categorias</span>
                    <small>Clique no üóëÔ∏è para remover</small>
                </div>
                <div class="categories-list" id="categories-list">
                    <!-- Categories will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- App Entry Point (ES6 Module) -->
    <script type="module" src="js/app.js"></script>
</body>

</html>